-- delete duplicated stock and orders (order amendment is ignore) --create table tmp_duplicate_instrument (--instrument_code varchar2(10)--);--insert into tmp_duplicate_instrument--select instrument_code from v_instrument group by instrument_code having count(*) > 1;--delete from orders where instrument_oid in (select instrument_oid from stock where--instrument_code in (select instrument_code from tmp_duplicate_instrument));--delete from orders where instrument_oid in (select instrument_oid from bond where--instrument_code in (select instrument_code from tmp_duplicate_instrument));--delete from stock where instrument_code in (select instrument_code from tmp_duplicate_instrument);--delete from bond where instrument_code in (select instrument_code from tmp_duplicate_instrument);--drop table tmp_duplicate_instrument;-- delete position record-- delete from cacc_security_position where cacc_oid not in (select cacc_oid from client_account_2 where cacc_code like '988%');-- delete from cacc_security_pos_sum where cacc_oid not in (select cacc_oid from client_account_2 where cacc_code like '988%');-- delete from cacc_cash_position where cacc_oid not in (select cacc_oid from client_account_2 where cacc_code like '988%');-- delete from cacc_cash_pos_sum where cacc_oid not in (select cacc_oid from client_account_2 where cacc_code like '988%');-- delete from cacc_security_position;-- delete from cacc_security_pos_sum;-- delete from cacc_cash_position;-- delete from cacc_cash_pos_sum;-- clear order related tables-- truncate table orders;-- truncate table order_amdmt;-- truncate table order_apvl_dtl_2;-- truncate table order_history;-- truncate table order_history_rmk;-- truncate table order_split_pending_rec_dtl;-- truncate table order_split_pending_rec_master;-- truncate table executed_order;-- truncate table ams_market_download;-- truncate table ams_market_index;-- clear EA related tables-- truncate table ams_order_msg;-- truncate table ams_manual_trade;-- truncate table ord_dph_queue;-- reset OG login password-- update ams_og set ams_og_logon_pwd = '123456' where ams_og_code = 'OG01';update ocg_og set ocg_logon_pwd = 'Ab123456' where ocg_code in ('CC01133001', 'CO0113301');-- -- set trade dateupdate exchange set trade_date = decode(trim(to_char(sysdate, 'DAY')), 'SATURDAY', trunc(sysdate), trunc(next_day(sysdate, 'SAT'))) where exch_code = 'HKG';update exchange set prev_trade_date = trade_date - 1;update oper_unit_exch set trade_date = decode(trim(to_char(sysdate, 'DAY')), 'SATURDAY', trunc(sysdate), trunc(next_day(sysdate, 'SAT')));-- set market ready timeupdate oper_unit_exch set market_ready_datetime = to_date(to_char(decode(trim(to_char(sysdate, 'DAY')), 'SATURDAY', trunc(sysdate), trunc(next_day(sysdate, 'SAT'))), 'YYYY/MM/DD') || ' 05:00:00', 'YYYY/MM/DD HH24:MI:SS');-- Delete Exchange Board Holidaydelete from exch_holiday where holiday_date = (select trade_date from exchange where exch_code='HKG');delete from exch_brd_holiday where holiday_date = (select trade_date from exchange where exch_code='HKG');commit;exit;
